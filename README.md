# Drova Desktop

И так, доброе время уток, мы здесь будем настраивать Drova Desktop для работы без наших аккаунтов. 

Нам понадобятся: 
+ ShadowDefender ( активированный и защищенный паролем)
+ Роутер, прошитый OpenWrt или Debian( чтобы ловить подключение и исполнять команды ) с python 3.12
+ установленный на роутере socat
+ проброс всех портов кроме 7985 на таргете средствами роутера
+ Установленный openssh-server на Windows и добавленный в автозагрузку

### Подготовка

Для того чтобы начать, склонируйте данный репозиторий на роутер.

Установите poetry 
```bash
pipx install poetry
```

Установите зависимости проекта

```bash
poetry install
```

После этого надо настроить env переменные. Выполните команду `cp .env.example .env` и редактируйте `.env` файл - там находятся настройки для скриптов, давайте их рассмотрим. 

```bash
WINDOWS_HOST=192.168.0.10 # ip адрес вашей тачки, на которой вы хотите развернуть Desktop
WINDOWS_LOGIN=Administrator # ваш локальный администратор - который должен быть залогинен и под кем будет заходить клиент
WINDOWS_PASSWORD=VeryStrongPassword # пароль от этого пользователя

SHADOW_DEFENDER_PASSWORD="ReallyVeryStrongPassword" # пароль от ShadowDefender - не оставляйте его без пароля! А то вам закоммитят все что натворили! 
SHADOW_DEFENDER_DRIVES="CDE" # здесь перечислите слитно все диски, на которых должен сработать ShadowDefender - в данном случае 3 диска: C, D и E - подразумевается что других нет. Если диск 1 - только C - оставляете только E
```

После настройки теперь можно проверить, работает ли и верно ли указаны настройки. Залогинтесь по VNC в ваш windows, откройте со своими credentials steam и epic games - а так же желательно открыть ShadowDefender - чтобы увидеть что все ок. 

Дальше выполняем команду на роутере:

```bash
poetry run python drova_validate
```

Если ничего не произошло на тачке - вы ошиблись в настройках ( логирования нету пока ), и вам стоит проверить `.env` который описан выше. Повторяйте настройку, пока после команды у вас не выключится стим с эпиком, и shadow defender не перейдет в shadow режим на ваших дисках

Как только добились, что оно работает, а перезапуск стима и эпика показывает что вы не залогинены, можно проверить сброс этих настроек. Выполните 

```bash
poetry run python after_disconnect.sh
```

Windows машина должна перезагрузиться и вы вновь окажетесь залогинеными в своих аккаунтах и все обновления будут качаться! 

### Автозапуск

В зависимости от вашего роутера - поставьте в автозагрузку команду `socket.sh 8000` - где вместо 8000 впишите первый порт, который открыт всегда на listening и который вы ранее пробрасывали через настройки роутера. PortMapping в этом случае надо выключить - на порт windows 7985 будет пробрасываться через socat.
